# Set DISPLAY for WSL2
# one of the following asignments should work
#export DISPLAY=localhost:0.0 # works on count
#export DISPLAY=$(grep nameserver /etc/resolv.conf | awk '{print $2}'):0.0
export DISPLAY=$(route.exe print | grep 0.0.0.0 | head -1 | awk '{print $4}'):0.0 # works on lappy

# X Window
if [ -z "${DISPLAY}" ]; then
    export DISPLAY=localhost:0.0
    echo "setting DISPLAY to $DISPLAY"
else
    echo "DISPLAY set to $DISPLAY"
fi

alias xming='/mnt/c/Program\ Files\ \(x86\)/Xming/Xming.exe >/dev/null 2>&1 :0 -clipboard -multiwindow -silent-dup-error -logverbose 0 &'
alias vcx='/mnt/c/Program\ Files/VcXsrv/vcxsrv.exe >/dev/null 2>&1 :0 -ac -clipboard -multiwindow -silent-dup-error &'

# Check if xwin is running
# -x flag only match processes whose name (or command line if -f is
# specified) exactly match the pattern. 

PROG="vcxsrv.exe"
if pgrep -x $PROG >/dev/null
then
    echo "$PROG is already running"
    return 0
else
    DIR=/mnt/c/Program\ Files/VcXsrv
    if [ -d "$DIR" ]; then
	if [ -f "$DIR/$PROG" ]; then
	    echo -e "Launching $PROG...\c"
	    vcx
	    if [[ $? == 0 ]]; then
		echo "OK"
		return 0
	    else
		echo "failed"
		unalias vcx
	    fi
	else	
	    echo "$PROG not found"
	    unalias vcx
	fi
    else	
	echo "$DIR not found"
	unalias vcx
    fi
fi

PROG="Xming.exe"
if pgrep -x $PROG >/dev/null
then
    echo "$PROG is already running"
    return 0   
else
    DIR=/mnt/c/Program\ Files\ \(x86\)/Xming
    if [ -d "$DIR" ]; then
	if [ -f "$DIR/$PROG" ]; then
	    echo -e "Launching $PROG...\c"
	    xming
	    if [[ $? == 0 ]]; then
		echo "OK"
		return 0   
	    else
		echo "failed"
		unalias xming
	    fi
	else	
	    echo "$PROG not found"
	    unalias xming
	fi
    else	
	echo "$DIR not found"
	unalias xming
    fi
fi
