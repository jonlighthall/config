# ~/config/.bashrc_common
# Interactive shell settings for UNIX-like systems
# Note: this file must use unix line endings (LF)! 
if [ -z $VB ]; then
    export VB=false
else
    if $VB; then
	comTAB="   "
	TAB+=$comTAB
	echo "${TAB}running $BASH_SOURCE..."
    fi
fi

# Settings
# Commands to save
export HISTFILESIZE=100000
export HISTSIZE=40000
# Don't put duplicate lines in the history
export HISTCONTROL=ignoredups
export HISTIGNORE=$'bg:exit:ls:pwd:history'
# Realtime history
shopt -s histappend
PROMPT_COMMAND="history -a;$PROMPT_COMMAND"
# Timestamp history
HISTTIMEFORMAT="%F %T "
# Editors
export EDITOR=emacs
export GIT_EDITOR=emacs
export SVN_EDITOR=emacs
set -o emacs

# Aliases 
alias close='source ~/.bash_logout;killall -v -u $USER$USERNAME; exit'
alias diffy='diff --color=auto --suppress-common-lines -yiEZbwB'
alias du0='duf --max-depth=0'
alias du1='duf --max-depth=1'
alias du2='duf --max-depth=2'
alias e='emacs'
alias en='emacs -nw'
alias fb='ff | perl -lne "print if not -T"' # find binary
alias fd='find ./ -not -path "*/.git/*" -type d' # find directory
alias ff='find ./ -not -path "*/.git/*" -type f' # find file
alias fl='find ./ -maxdepth 1 -type l -exec ls --color -l {} \;' # find link
alias grep='grep --color=auto -iIr --exclude-dir=".git"'
alias lS='ls -ltS'
alias la='ls -la'
alias lh='ls -ld .?*' # list hidden only
alias ls='ls --color'
alias lt='ls -ltr' # sort by time
alias ping='ping -c 5'
alias pwd='pwd -L;pwd -P'

# Fucntions
function duf {	       
    du -k "$@" | sort -n |
	while read size fname; do
     	    for unit in k M G T P E Z Y;
	    do
		if [ $size -lt 1024 ]; then
		    echo -e "${size}${unit}B${fname}";
		    break;
		fi;
		size=$((size/1024));
	    done;
	done
}

# Path additions
ADDPATH=${HOME}/bin
if [[ ":$PATH" != *":${ADDPATH}"*  ]]; then
    if [ -d "${ADDPATH}" ] ; then
	if $VB; then
	    echo "${TAB}${ADDPATH} not found in PATH"
	fi
	export PATH=$PATH:$ADDPATH
    else
	echo "${TAB}${ADDPATH} not found"
    fi
else
    if $VB; then
	echo "${TAB}${ADDPATH} already in PATH"
    fi
fi
TAB=${TAB::${#TAB}-${#comTAB}}
